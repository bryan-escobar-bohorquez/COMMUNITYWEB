<!DOCTYPE html>
<html lang="es">
<head>
    <link rel="stylesheet" href="styleregistro.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Usuario</title>
</head>
<body>
    <div class="caja">
        <h3>Registro de Usuario</h3>

        <form id="form-registro">
            <!-- Nombre Completo -->
            <label for="nombre">Nombre Completo:</label>
            <input type="text" id="nombre" name="nombre" required><br><br>
            
            <!-- Correo Electrónico -->
            <label for="email">Correo Electrónico:</label>
            <input type="email" id="email" name="email"placeholder="correo@gmail.com" required><br><br>
            
            <!-- Teléfono -->
            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" pattern="[0-9]{10}" required><br><br>
            
            <!-- Contraseña -->
            <label for="password">Contraseña:</label>
            <input type="password" id="password" name="password" required><br><br>
            
            <!-- Confirmar Contraseña -->
            <label for="confirm_password">Confirmar Contraseña:</label>
            <input type="password" id="confirm_password" name="confirm_password" required><br><br>
            
            <!-- Fecha de Nacimiento -->
            <label for="fecha_nacimiento">Fecha de Nacimiento:</label>
            <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required><br><br>
            
            <!-- Género -->
            <label for="genero">Género:</label>
            <select id="genero" name="genero" required>
                <option value="masculino">Masculino</option>
                <option value="femenino">Femenino</option>
                <option value="otro">Otro</option>
            </select><br><br>

            <!-- Aceptar Términos y Condiciones -->
            <p>
                Al hacer clic en "Registrarte", aceptas nuestras Condiciones, la Política de privacidad y la Política de cookies. 
                Es posible que te enviemos notificaciones por SMS, que puedes desactivar cuando quieras.
            </p>

            <!-- Botón de Registro -->
            <input type="submit" value="Registrarte" class="boton-registro">
        </form>
    </div>

    <script>
    document.getElementById("form-registro").addEventListener("submit", async (e) => {
        e.preventDefault();

        const password = document.getElementById("password").value;
        const confirmPassword = document.getElementById("confirm_password").value;

        if (password !== confirmPassword){
            alert("Las contraseñas no coinciden.")
            return;
        }


        const datosUsuario = {
            nombre: document.getElementById("nombre").value,
            email: document.getElementById("email").value,
            telefono: document.getElementById("telefono").value,
            password: password,
            confirm_password: confirmPassword,
            fecha_nacimiento: document.getElementById("fecha_nacimiento").value,
            genero: document.getElementById("genero").value,
        };

        try {
            const respuesta = await fetch('http://localhost:5000/api/auth/registro', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(datosUsuario)
            });

            const datos = await respuesta.json();

            if (!respuesta.ok) {
                throw new Error(datos.mensaje || 'Error en el registro');
            }

            // Guardar token y redirigir
            localStorage.setItem('token', datos.token);
            localStorage.setItem('usuario', JSON.stringify(datos.usuario));
            window.location.href = "../usuario/InSesion.html";

        } catch (error) {
            alert("Registro fallido: " + error.message);
        }
    });
    </script>
</body>
</html>
